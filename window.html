<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <title>Tab Organizer</title>

    <script src="/lib/Options.js"></script>
    <script src="/themes/color-sync.js"></script>
    <script>
        /*global Options */
        "use strict";

        (function () {
            var link = document.createElement("link");
            link.rel = "stylesheet";
            link.type = "text/css";

            function href(value) {
                link.href = "/views/" + value + ".css";
            }
            href(Options.get("windows.type"));
//
//            Options.event.on("change", function (event) {
//
//            });

            function find(text, func) {
                var rules = link.sheet.cssRules;

                for (var i = 0; i < rules.length; i += 1) {
                    if (rules[i].selectorText === text) {
                        return func(rules[i]);
                    }
                }
            }

            var types = {
                "grid": function () {
                    find(".window", function (rule) {
                        var width = Options.get("windows.grid.columns");
                        rule.style.width = 100 / width + "%";

                        var height = Options.get("windows.grid.rows");
                        rule.style.height = 100 / height + "%";
                    });
                }
            };

            function update() {
                var action = types[Options.get("windows.type")];
                if (action) {
                    action();
                }
            }
            addEventListener("DOMContentLoaded", update, true);

            Options.event.on("change", function (event) {
                var columns = (event.name === "windows.grid.columns"),
                    rows = (event.name === "windows.grid.rows"),
                    type = (event.name === "windows.type");

                if (type) {
                    href(event.value);
                }

                if (columns || rows || type) {
//                    state.list.forEach(function (item) {
//                        item.update();
//                    });
                    update();

                    state.search({ scroll: true, focused: true, nodelay: true });
                }
            });

            document.head.appendChild(link);
        }());
    </script>

    <link rel="stylesheet" type="text/css" href="/lib/Options.css" />
    <link rel="stylesheet" type="text/css" href="/lib/UI%20Helper.css" />
    <link rel="stylesheet" type="text/css" href="/window.css" />
</head>
<body>
    <script src="/lib/Platform.js"></script>
    <script src="/lib/Undo.js"></script>
    <script src="/lib/Array.js"></script>
    <script src="/lib/Global%20Helper.js"></script>
    <script src="/lib/UI%20Helper.js"></script>
    <script src="/lib/Event%20Helper.js"></script>
    <script src="/lib/parser.js"></script>
    <script src="/lib/action.search.js"></script>
    <script src="/lib/Queue.js"></script>
    <script src="/Tab%20Organizer.js"></script>

    <script src="/lib/Analytics.js"></script>

    <!--**
        *  This is to make it easier to take screenshots when the UI changes.
        *-->
    <!--!<script src="http://documentation.tab-organizer.googlecode.com/hg/screenshot.js"></script>-->
    <script src="/window.js"></script>
</body>
</html>
